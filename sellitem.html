<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sell an Item</title>
    <link rel="stylesheet" href="sellstyle.css">
</head>
<body>
    <h1>Sell an Item</h1>
    <form id="sellForm">
        <label for="product_name">Product Name:</label>
        <input type="text" id="product_name" required>

        <label for="features">Features:</label>
        <textarea id="features" required></textarea>

        <label for="price">Fixed Price (₹):</label>
        <input type="number" id="price" step="0.01" required>

        <label for="bid_price">Starting Bid Price (₹):</label>
        <input type="number" id="bid_price" step="0.01" required>

        <label for="time_limit">Time Limit (in hours):</label>
        <input type="number" id="time_limit" min="1" required>

        <label for="product_image">Upload Image(s):</label>
        <input type="file" id="product_image" accept="image/*" multiple required>

        <button type="submit">List Item</button>
    </form>

    <h2>HISTORY</h2>
    <div id="history"></div>

    <script>
        document.getElementById("sellForm").addEventListener("submit", async function(event) {
            event.preventDefault();
        
            let productName = document.getElementById("product_name").value;
            let features = document.getElementById("features").value;
            let price = document.getElementById("price").value;
            let bidPrice = document.getElementById("bid_price").value;
            let timeLimit = document.getElementById("time_limit").value;
            let imageInput = document.getElementById("product_image").files;
        
            let expirationTime = Date.now() + timeLimit * 60 * 60 * 1000; // Convert hours to milliseconds
        
            let imagesArray = [];
        
            // Read images as Base64
            async function readImages() {
                return new Promise((resolve) => {
                    let imagesProcessed = 0;
                    for (let i = 0; i < imageInput.length; i++) {
                        let reader = new FileReader();
                        reader.readAsDataURL(imageInput[i]);
                        reader.onload = function () {
                            imagesArray.push(reader.result);
                            imagesProcessed++;
                            if (imagesProcessed === imageInput.length) {
                                resolve();
                            }
                        };
                    }
                });
            }
        
            await readImages();
        
            let item = { productName, features, price, bidPrice, imagesArray, expirationTime };
        
            try {
                let response = await fetch("http://127.0.0.1:5000/api/sell", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(item)
                });
        
                let result = await response.json();
                if (result.success) {
                    alert("Item listed successfully!");
                    location.reload();
                } else {
                    alert("Error: " + result.error);
                }
            } catch (error) {
                console.error("❌ Error saving item:", error);
            }
        });
        </script>
        
        
</body>
</html>
